<?php//===============================================================class PluginReceptiondesk_ModuleTools_MapperTools extends Mapper{//===============================================================	public function getFilesByTargetTmp($sTargetTmp){		$sql="SELECT * FROM ".Config::Get('db.table.receptiondesk_files')." WHERE file_target_tmp=?;";		$aReturn=array();		if($aRows=$this->oDb->select($sql,$sTargetTmp)) foreach($aRows as $aRow) $aReturn[]=Engine::GetEntity('PluginReceptiondesk_ModuleTools_EntityFile',$aRow);		return $aReturn;	}//===============================================================	public function getCountFilesByTargetTmp($sTargetTmp){		$sql="SELECT count(file_id) FROM ".Config::Get('db.table.receptiondesk_files')." WHERE file_target_tmp=?;";		$aCount=$this->oDb->selectCol($sql,$sTargetTmp);		return $aCount[0];	}//===============================================================	public function AddFile(PluginReceptiondesk_ModuleTools_EntityFile $oFile){		if(!$oFile->getTargetTmp()) return false;		$sql="INSERT INTO ".Config::Get('db.table.receptiondesk_files')." SET file_path=?,file_name=?,file_size=?,file_target_tmp=?;";		if($iFileId=$this->oDb->query($sql,$oFile->getPath(),$oFile->getName(),$oFile->getSize(),$oFile->getTargetTmp())) return $iFileId;		return false;	}//===============================================================	public function DeleteFile(PluginReceptiondesk_ModuleTools_EntityFile $oFile){		$sql="DELETE FROM ".Config::Get('db.table.receptiondesk_files')." WHERE file_id=?d;";		if($aRow=$this->oDb->query($sql,$oFile->getId())!=false) return true;		return false;	}//===============================================================	public function UpdateFile($sQuestionId,$sTarget){		$sql="UPDATE ".Config::Get('db.table.receptiondesk_files')." SET question_id=?d,file_target_tmp=NULL WHERE file_target_tmp=?;";		if($this->oDb->query($sql,$sQuestionId,$sTarget)!==false) return true;		return false;	}//===============================================================	public function GetFileByTargetTmp($sFileId,$sTarget){		$sql="SELECT * FROM ".Config::Get('db.table.receptiondesk_files')." WHERE file_id=?d { AND file_target_tmp IS NOT NULL AND file_target_tmp=? } LIMIT 0,1;";		if($aRow=$this->oDb->selectRow($sql,$sFileId,is_null($sTarget) ? DBSIMPLE_SKIP : $sTarget)) return Engine::GetEntity('PluginReceptiondesk_ModuleTools_EntityFile',$aRow);		return null;	}//===============================================================	public function GetFiles($sQuestionId){		$sql="SELECT * FROM ".Config::Get('db.table.receptiondesk_files')." WHERE question_id=?d;";		$aReturn=array();		if($aRows=$this->oDb->select($sql,$sQuestionId)) foreach($aRows as $aRow) $aReturn[]=Engine::GetEntity('PluginReceptiondesk_ModuleTools_EntityFile',$aRow);		return $aReturn;	}//===============================================================}?>